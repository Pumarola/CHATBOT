<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Chatbot</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
  }
  #chatbot {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    display: flex;
    flex-direction: column;
    font-family: sans-serif;
  }
  #chat-window {
    flex: 1;
    overflow-y: auto;
    padding: 10px;
  }
  #input-area {
    display: flex;
    border-top: 1px solid #ccc;
    padding: 10px;
  }
  #user-input {
    flex: 1;
    padding: 5px;
  }
  #send-btn {
    margin-left: 10px;
    padding: 5px 10px;
  }
  .message {
    margin: 5px 0;
    padding: 8px 12px;
    border-radius: 5px;
    max-width: 70%;
  }
  .user {
    align-self: flex-end;
    background-color: #f0f0f0;
  }
  .assistant {
    align-self: flex-start;
    background-color: #e0ffe0;
  }
</style>
</head>
<body>
<div id="chatbot">
  <div id="chat-window"></div>
  <div id="input-area">
    <input id="user-input" type="text" placeholder="Escribe tu mensaje" />
    <button id="send-btn">Enviar</button>
  </div>
</div>
<script>
const apiKey = "REEMPLAZA_CON_TU_API_KEY"; // Coloca aquí tu API Key de OpenAI
const systemMessage = "Eres un asistente útil."; // Mensaje inicial del system
let messages = [{ role: 'system', content: systemMessage }];

const chatWindow = document.getElementById('chat-window');
const input = document.getElementById('user-input');
const sendBtn = document.getElementById('send-btn');

function addMessage(text, sender) {
  const div = document.createElement('div');
  div.className = `message ${sender}`;
  div.textContent = text;
  chatWindow.appendChild(div);
  chatWindow.scrollTop = chatWindow.scrollHeight;
}

async function sendMessage() {
  const content = input.value.trim();
  if (!content) return;
  addMessage(content, 'user');
  messages.push({ role: 'user', content });
  input.value = '';
  try {
    const response = await fetch('https://api.openai.com/v1/chat/completions', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${apiKey}`
      },
      body: JSON.stringify({
        model: 'gpt-4o',
        messages: messages
      })
    });
    const data = await response.json();
    const reply = data.choices[0].message.content.trim();
    addMessage(reply, 'assistant');
    messages.push({ role: 'assistant', content: reply });
  } catch (err) {
    addMessage('Error al conectar con la API.', 'assistant');
  }
}

sendBtn.addEventListener('click', sendMessage);
input.addEventListener('keydown', e => {
  if (e.key === 'Enter') sendMessage();
});
</script>
</body>
</html>
